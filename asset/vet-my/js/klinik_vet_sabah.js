// Auto-generated from AnimalPassport DVS CSV
const ILMU_KLINIK_SABAH = [
  {
    name: "BDC VETERINARY CLINIC",
    address: "NO-2, WEI HING LIGHT INDUSTRIAL CENTRE, JALAN KILANG, KOLOMBONG, INANAM 89450 KOTA KINABALU SABAH",
    area: "KOLOMBONG",
    state: "SABAH",
    clinicPhone: "124185100.0",
    mobilePhone: "",
    email: ""
  },
  {
    name: "BORNEO ANIMALS CLINIC",
    address: "LOT 17, TAMAN JAYA USAHA, JALAN TUARAN-INANAM, , SABAH. 88450 KOTA KINABALU SABAH",
    area: "JALAN TUARAN-INANAM",
    state: "SABAH",
    clinicPhone: "167339901.0",
    mobilePhone: "",
    email: ""
  },
  {
    name: "CENTURY ANIMALS MEDICAL CENTRE",
    address: "LOT 25 BLOK C PLAZA UTAMA JALAN PENAMPANG BYPASS 88200 KOTA KINABALU SABAH",
    area: "SABAH",
    state: "SABAH",
    clinicPhone: "88731032.0",
    mobilePhone: "",
    email: ""
  },
  {
    name: "GOODY VETERINARY CLINIC",
    address: "LOT 115, MDLD 8715, GROUND FLOOR, PERDANA SQUARE, JALAN SILAM 91100 LAHAD DATU SABAH",
    area: "PERDANA SQUARE",
    state: "SABAH",
    clinicPhone: "129893892.0",
    mobilePhone: "",
    email: ""
  },
  {
    name: "KINABALU ANIMAL CLINIC",
    address: "LOT 6, LORONG DURIAN 3, KIAN YAP INDUSTRIAL ESTATE 88450 KOTA KINABALU SABAH",
    area: "LORONG DURIAN 3",
    state: "SABAH",
    clinicPhone: "88385804.0",
    mobilePhone: "",
    email: "kinabaluvet@gmail.com"
  },
  {
    name: "KINGFISHER VETERINARY CLINIC",
    address: "LOT 22-0, GF, BLOCK D, LORONG 6, PLAZA KINGFISHER, , 88450 KOTA KINABALU SABAH",
    area: "PLAZA KINGFISHER",
    state: "SABAH",
    clinicPhone: "162327726.0",
    mobilePhone: "",
    email: ""
  },
  {
    name: "KLINIK HAIWAN & SURGERI TUARAN",
    address: "LOT 14&15 BERUNGJS COMMERCIAL CENTRE 89208 TUARAN SABAH",
    area: "SABAH",
    state: "SABAH",
    clinicPhone: "88785389.0",
    mobilePhone: "",
    email: ""
  },
  {
    name: "KLINIK HAIWAN KOTA BELUD",
    address: "WISMA TANJONG,KEDAI NO. 2, KG. PIRASAN,JALAN RANAU BYPASS 89150 KOTA BELUD SABAH",
    area: "KG. PIRASAN",
    state: "SABAH",
    clinicPhone: "142695255.0",
    mobilePhone: "",
    email: ""
  },
  {
    name: "KLINIK HAIWAN S&H",
    address: "TB 19584, LOT 214, BANDAR SRI INDAH, FASA 4B, BATU 10, JALAN APAS 91000 TAWAU SABAH",
    area: "BATU 10",
    state: "SABAH",
    clinicPhone: "01128999192",
    mobilePhone: "",
    email: ""
  },
  {
    name: "LIKAS VETERINARY CLINIC",
    address: "GROUND FLOOR LOT 12, LORONG KELABU, TAMAN CEMPAKA 88400 KOTA KINABALU SABAH",
    area: "LORONG KELABU",
    state: "SABAH",
    clinicPhone: "01131444398",
    mobilePhone: "",
    email: ""
  },
  {
    name: "NN ANIMAL CLINIC",
    address: "LOT 29, BLOCK E, GROUNF FLOOR, MIDTOWN PLAZA 90000 SANDAKAN SABAH",
    area: "GROUNF FLOOR",
    state: "SABAH",
    clinicPhone: "0176144202",
    mobilePhone: "",
    email: ""
  },
  {
    name: "NOAHâ€™S ARK VETERINARY CLINIC",
    address: "LOT NO.17 &18, GROUND FLOOR, BLOCK E, SURIA INANAM 88450 KOTA KINABALU SABAH",
    area: "BLOCK E",
    state: "SABAH",
    clinicPhone: "0168711718",
    mobilePhone: "168711718.0",
    email: "noahsarkvc1718@gmail.com"
  },
  {
    name: "ONE PET VETERINARY CLINIC",
    address: "LOT NO.19-0, GROUND FLOOR, JALAN PENGALAT LOK KAWI, LOK KAWI POINT, KINARUT 89600 PAPAR SABAH",
    area: "LOK KAWI POINT",
    state: "SABAH",
    clinicPhone: "01127240190",
    mobilePhone: "",
    email: ""
  },
  {
    name: "PURPLE PAWS VETERINARY CLINIC PENAMPANG",
    address: "LOT NO.6, GROUND FLOOR, WINDROSE SQUARE JALAN. PINTAS PENAMPANG BY PASS 88300 KOTA KINABALU SABAH",
    area: "GROUND FLOOR",
    state: "SABAH",
    clinicPhone: "1116685658.0",
    mobilePhone: "",
    email: ""
  },
  {
    name: "SABAH ANIMAL MEDICAL CENTRE",
    address: "SHOPLOT 4, TAMAN FU YEN PH 3, LORONG ANGSA 1, JALAN KOLAM, LUYANG 88300 KOTA KINABALU SABAH",
    area: "JALAN KOLAM",
    state: "SABAH",
    clinicPhone: "88253481.0",
    mobilePhone: "",
    email: ""
  },
  {
    name: "SANDAKAN VETERINARY CLINIC",
    address: "GROUND FLOOR, LOT 2A & 2B, BLOCK G, TAMAN TAI FAI YIN 4, MILE 8, LABUK ROAD 90009 SANDAKAN SABAH",
    area: "MILE 8",
    state: "SABAH",
    clinicPhone: "89660691.0",
    mobilePhone: "",
    email: ""
  },
  {
    name: "SHAKALAKA VET CARE AND SURGERY",
    address: "LOT 10-0, GROUND FLOOR, BLOCK B, ROYAL PLAZA 88200 PUTATAN SABAH",
    area: "BLOCK B",
    state: "SABAH",
    clinicPhone: "088778574",
    mobilePhone: "",
    email: ""
  },
  {
    name: "SHULAN VETERINARY CLINIC",
    address: "NO. SE-3A, UNIVERISTY UTAMA SQUARE JALAN KAYU MAFANG, TELIPOK KOTA KINABALU 88450 KOTA KINABALU SABAH",
    area: "UNIVERISTY UTAMA SQUARE JALAN KAYU MAFANG",
    state: "SABAH",
    clinicPhone: "0146699858",
    mobilePhone: "",
    email: ""
  },
  {
    name: "SUNNY GARDEN VETERINARY CLINIC",
    address: "LOT 10, GRD FLOOR, MILE 1.5 TUARAN ROAD, P. O. BOX 10372 88804 KOTA KINABALU SABAH",
    area: "MILE 1.5 TUARAN ROAD",
    state: "SABAH",
    clinicPhone: "088257275",
    mobilePhone: "",
    email: ""
  },
  {
    name: "SUNRIZ VETERINARY CLINIC & SURGERY",
    address: "SUNRIZ VETERINARY CLINIC & SURGERY, LOT 61, LORONG BENONI 5, BENONI COMMERCIAL CENTRE 89600 PAPAR SABAH",
    area: "LORONG BENONI 5",
    state: "SABAH",
    clinicPhone: "0168025110",
    mobilePhone: "",
    email: ""
  },
  {
    name: "TAWAU VETERINARY CLINIC SDN.BHD",
    address: "TB14450, LOTA1, FIRST FLOOR, BANDAR HOTSPRING, JALAN AIRPANAS 91000 TAWAU SABAH",
    area: "BANDAR HOTSPRING",
    state: "SABAH",
    clinicPhone: "198534375.0",
    mobilePhone: "",
    email: ""
  },
  {
    name: "THE LITTLE VETERINARY CLINIC",
    address: "LOT 32 GROUND FLOOR WK COMMERCIAL CENTER SABAH 88300 KOTA KINABALU SABAH",
    area: "SABAH",
    state: "SABAH",
    clinicPhone: "143605165.0",
    mobilePhone: "",
    email: ""
  },
  {
    name: "VET2GO ANIMAL CLINIC & SURGERY",
    address: "A501, PETI SURAT NO 27 GAMBARON 1 89320 TELUPID SABAH",
    area: "A501",
    state: "SABAH",
    clinicPhone: "102309100.0",
    mobilePhone: "0166020065",
    email: "vet2goanimalclinic@gmail.com"
  },
];

(function initKlinikTool_SABAH() {
  const root = document.getElementById("klinik-haiwan-kl-tool");
  if (!root) return;
  const searchInput = root.querySelector("#ilmu-kl-search");
  const typeSelect  = root.querySelector("#ilmu-kl-type");  // optional, not used here
  const areaSelect  = root.querySelector("#ilmu-kl-area");
  const nearMeBtn   = root.querySelector("#ilmu-kl-nearme");
  const resetBtn    = root.querySelector("#ilmu-kl-reset");
  const resultsWrap = root.querySelector("#ilmu-kl-results");
  const countLabel  = root.querySelector("#ilmu-kl-count");

  function norm(str) {
    return (str || "").toString().toLowerCase();
  }

  function buildMapsUrl(c) {
    const q = encodeURIComponent((c.name || "") + ", " + (c.address || ""));
    return "https://www.google.com/maps/search/?api=1&query=" + q;
  }

  function render(list) {
    resultsWrap.innerHTML = "";
    if (!list.length) {
      resultsWrap.innerHTML = '<p style="font-size:0.9rem;color:#555;">Tiada klinik dijumpai. Cuba ubah kata kunci atau penapis.</p>';
      countLabel.textContent = "0 klinik haiwan ditemui.";
      return;
    }
    const frag = document.createDocumentFragment();
    list.forEach(function(c) {
      const card = document.createElement("article");
      card.className = "ilmu-kl-card";
      card.setAttribute("itemscope", "");
      card.setAttribute("itemtype", "https://schema.org/VeterinaryCare");

      const header = document.createElement("header");
      const nameEl = document.createElement("div");
      nameEl.className = "ilmu-kl-name";
      nameEl.textContent = c.name || "(Tanpa nama klinik)";
      nameEl.setAttribute("itemprop", "name");

      const tagEl = document.createElement("span");
      tagEl.className = "ilmu-kl-tag";
      tagEl.textContent = "SABAH";

      header.appendChild(nameEl);
      header.appendChild(tagEl);

      const areaEl = document.createElement("div");
      areaEl.className = "ilmu-kl-area";
      areaEl.textContent = "Kawasan: " + (c.area || c.state || "");

      const addrEl = document.createElement("div");
      addrEl.className = "ilmu-kl-address";
      addrEl.innerHTML = "<strong>Alamat:</strong> <span itemprop=\"address\">" + (c.address || "") + "</span>";

      const phoneEl = document.createElement("div");
      phoneEl.className = "ilmu-kl-phone";
      if (c.clinicPhone || c.mobilePhone) {
        const phones = [];
        if (c.clinicPhone) phones.push(c.clinicPhone);
        if (c.mobilePhone) phones.push(c.mobilePhone);
        phoneEl.innerHTML = "<strong>Telefon:</strong> " + phones.map(function(p){ return '<span itemprop=\"telephone\">' + p + "</span>"; }).join(" / ");
      }

      const actionsRow = document.createElement("div");
      actionsRow.className = "ilmu-kl-actions-row";

      const mapsLink = document.createElement("a");
      mapsLink.href = buildMapsUrl(c);
      mapsLink.target = "_blank";
      mapsLink.rel = "noopener nofollow";
      mapsLink.textContent = "Buka di Google Maps";

      const callLink = document.createElement("a");
      const phoneRaw = (c.clinicPhone || c.mobilePhone || "");
      if (phoneRaw) {
        callLink.href = "tel:" + phoneRaw.replace(/[^0-9+]/g, "");
        callLink.textContent = "Call Klinik";
      } else {
        callLink.href = buildMapsUrl(c);
        callLink.textContent = "Info Klinik";
      }

      actionsRow.appendChild(mapsLink);
      actionsRow.appendChild(callLink);

      card.appendChild(header);
      card.appendChild(areaEl);
      card.appendChild(addrEl);
      if (c.clinicPhone || c.mobilePhone) card.appendChild(phoneEl);
      card.appendChild(actionsRow);
      frag.appendChild(card);
    });
    resultsWrap.appendChild(frag);
    countLabel.textContent = list.length + " klinik haiwan & klinik veterinar dijumpai di SABAH.";
  }

  function applyFilters() {
    const q = norm(searchInput ? searchInput.value : "");
    const areaVal = areaSelect ? areaSelect.value : "";

    const base = ILMU_KLINIK_SABAH.slice();
    const filtered = base.filter(function(c) {
      if (areaVal) {
        if (!c.area || c.area.indexOf(areaVal) === -1) return false;
      }
      if (!q) return true;
      const haystack = norm((c.name || "") + " " + (c.address || "") + " " + (c.area || "") + " " + (c.state || ""));
      return haystack.indexOf(q) !== -1;
    }).sort(function(a,b){ return (a.name || "").localeCompare(b.name || ""); });

    render(filtered);
  }

  function setupListeners() {
    if (searchInput) searchInput.addEventListener('input', applyFilters);
    if (areaSelect) areaSelect.addEventListener('change', applyFilters);
    if (resetBtn) {
      resetBtn.addEventListener('click', function(){
        if (searchInput) searchInput.value = "";
        if (areaSelect) areaSelect.value = "";
        applyFilters();
      });
    }
    if (nearMeBtn) {
      nearMeBtn.addEventListener('click', function(){
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(function(pos){
            const lat = pos.coords.latitude;
            const lng = pos.coords.longitude;
            const base = "https://www.google.com/maps/search/";
            const q = encodeURIComponent("klinik haiwan veterinar near me");
            const url = base + q + "/@" + lat + "," + lng + ",14z";
            window.open(url, "_blank", "noopener");
          }, function(){
            window.open("https://www.google.com/maps/search/" + encodeURIComponent("klinik haiwan SABAH near me"), "_blank", "noopener");
          });
        } else {
          window.open("https://www.google.com/maps/search/" + encodeURIComponent("klinik haiwan SABAH near me"), "_blank", "noopener");
        }
      });
    }
  }

  setupListeners();
  applyFilters();
})();
