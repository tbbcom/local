// Auto-generated from AnimalPassport DVS CSV
const ILMU_KLINIK_JOHOR = [
  {
    name: "BATU ANIMAL CLINIC AND SURGERY",
    address: "16, JALAN SHAH BANDAR 6, TAMAN UNGKU AMINAH, JOHOR BAHRU 81300 JOHOR JOHOR",
    area: "TAMAN UNGKU AMINAH",
    state: "JOHOR",
    clinicPhone: "75570166.0",
    mobilePhone: "197127334.0",
    email: "vatemalee@hotmail.com"
  },
  {
    name: "DVS JOHOR",
    address: "KLINIK VETERINAR, JALAN KEBUN TEH, JOHOR BAHRU JOHOR",
    area: "JALAN KEBUN TEH",
    state: "JOHOR",
    clinicPhone: "",
    mobilePhone: "",
    email: ""
  },
  {
    name: "GLOBAL PETS VETS. CLINIC AND SURGERY",
    address: "18, JALAN JATI 1, TAMAN NUSA BESTARI JAYA, 83100 SKUDAI JOHOR",
    area: "TAMAN NUSA BESTARI JAYA",
    state: "JOHOR",
    clinicPhone: "",
    mobilePhone: "",
    email: ""
  },
  {
    name: "HAN VETERINARY SURGERY",
    address: "50, JALAN MOLEK 2/2, TAMAN MOLEK, 81100 JOHOR BAHRU JOHOR",
    area: "TAMAN MOLEK",
    state: "JOHOR",
    clinicPhone: "",
    mobilePhone: "",
    email: ""
  },
  {
    name: "HARI PETS CLINIC & SURGERY",
    address: "45, JALAN CHENGAL, BATU PAHAT GARDEN, 83000 BATU PAHAT, JOHOR JOHOR",
    area: "83000 BATU PAHAT",
    state: "JOHOR",
    clinicPhone: "074349699",
    mobilePhone: "",
    email: "doctor_mohan@yahoo.com"
  },
  {
    name: "JB ANIMAL MEDICAL CLINIC",
    address: "35, JALAN ANGGERIK 2/7, TAMAN ANGGERIK, 81200 JOHOR BAHRU JOHOR",
    area: "TAMAN ANGGERIK",
    state: "JOHOR",
    clinicPhone: "",
    mobilePhone: "",
    email: ""
  },
  {
    name: "KLINIK HAIWAN ALBY",
    address: "NO 37-2,TINGKAT BAWAH, JLN DAUD, PEKAN MUAR, 84000 MUAR, JOHOR DARUL TA'ZIM 84000 MUAR JOHOR",
    area: "84000 MUAR",
    state: "JOHOR",
    clinicPhone: "136920364.0",
    mobilePhone: "",
    email: ""
  },
  {
    name: "KLINIK HAIWAN CT VET",
    address: "\"NO 34/34A, 36/36A, JALAN MEDAN NUSA PERINTIS 12, TAMAN NUSA PERINTIS 3, 81150 GELANG PATAH JOHOR 81150 GELANG PATAH JOHOR",
    area: "TAMAN NUSA PERINTIS 3",
    state: "JOHOR",
    clinicPhone: "72274930.0",
    mobilePhone: "187631242.0",
    email: ""
  },
  {
    name: "KLINIK HAIWAN PET PARADISE",
    address: "NO 4, JALAN PADI EMAS 2, BANDAR BARU UDA, 81200 JOHOR BAHRU JOHOR",
    area: "BANDAR BARU UDA",
    state: "JOHOR",
    clinicPhone: "072309026",
    mobilePhone: "127182614.0",
    email: "firharith@gmail.com"
  },
  {
    name: "KLINIK HAIWAN VET PARTNERS",
    address: "535, JALAN PERSISIRAN PERLING 1, TAMAN PERLING, 81200 JOHOR BAHRU JOHOR",
    area: "TAMAN PERLING",
    state: "JOHOR",
    clinicPhone: "072320541",
    mobilePhone: "0167164343",
    email: "check_nam@yahoo.com"
  },
  {
    name: "KLINIK HAIWAN VET PARTNERS ( ISKANDAR PUTERI )",
    address: "16-18,JALAN JATI 1,TAMAN NUSA BESTARI JAYA,79150,ISKANDAR PUTERI,JOHOR BAHRU JOHOR",
    area: "ISKANDAR PUTERI",
    state: "JOHOR",
    clinicPhone: "",
    mobilePhone: "0176226430",
    email: ""
  },
  {
    name: "KLINIK HAIWAN VET PARTNERS ( MASAI )",
    address: "56-58,JALAN PERMAS 10,BANDAR BARY PERMAS JAYA,81750,MASAI,JOHOR JOHOR",
    area: "MASAI",
    state: "JOHOR",
    clinicPhone: "",
    mobilePhone: "0112830675",
    email: ""
  },
  {
    name: "KLINIK HAIWAN VET PARTNERS (BATU PAHAT)",
    address: "64,JALAN SUSUR PERDANA TENGAH,TAMAN BUKIT PERDANA II, 83000 BATU PAHAT JOHOR",
    area: "TAMAN BUKIT PERDANA II",
    state: "JOHOR",
    clinicPhone: "",
    mobilePhone: "019-243325",
    email: ""
  },
  {
    name: "KLINIK VETERINAR WONDERCARE",
    address: "15 & 17, JALAN ROS MERAH 2/8, TAMAN JOHOR JAYA, JOHOR BAHRU, 81100 JOHOR JOHOR",
    area: "JOHOR BAHRU",
    state: "JOHOR",
    clinicPhone: "",
    mobilePhone: "197041800.0",
    email: "edwinsingam@gmail.com"
  },
  {
    name: "KOH ANIMAL CLINIC",
    address: "62, JALAN KEMUNTING, TAMAN KEBUN TEH, 80250 SKUDAI JOHOR",
    area: "TAMAN KEBUN TEH",
    state: "JOHOR",
    clinicPhone: "",
    mobilePhone: "",
    email: ""
  },
  {
    name: "NIVEETHA ANIMAL TREATMENT CENTRE",
    address: "NO. 8, JLN NAGASARI 1, BANDAR SEGAMAT BARU 85000 SEGAMAT, JOHOR JOHOR",
    area: "BANDAR SEGAMAT BARU 85000 SEGAMAT",
    state: "JOHOR",
    clinicPhone: "07-9436084",
    mobilePhone: "196667928.0",
    email: "niveethavet13@gmail.com"
  },
  {
    name: "P.E.T.S VETERINARY CENTRE",
    address: "103, JALAN SUSUR PERDANA TENGAH, TAMAN BUKIT PERDANA, BATU PAHAT 83000 JOHOR JOHOR",
    area: "TAMAN BUKIT PERDANA",
    state: "JOHOR",
    clinicPhone: "",
    mobilePhone: "172525999.0",
    email: "tomae2@gmail.com"
  },
  {
    name: "PAWSITIVE VETERINARY CLINIC",
    address: "175G, JALAN SENTRAL 24, TAMAN NUSA SENTRAL, 79100 ISKANDAR PUTERI, JOHOR 79100 ISKANDAR PUTERI JOHOR",
    area: "79100 ISKANDAR PUTERI",
    state: "JOHOR",
    clinicPhone: "0146623472",
    mobilePhone: "",
    email: "edalyanaa@gmail.com"
  },
  {
    name: "PERMAS ANIMAL CLINIC AND SURGERY",
    address: "9, JALAN PERMAS 10/3, BANDAR BARU PERMAS JAYA, 81750 MASAI JOHOR",
    area: "BANDAR BARU PERMAS JAYA",
    state: "JOHOR",
    clinicPhone: "",
    mobilePhone: "",
    email: ""
  },
  {
    name: "ROSS VETERINARY CLINIC",
    address: "NO 80, JALAN ECO CASCADIA 6/2, TAMAN SETIA ECO CASCADIA, 81100, JOHOR BAHRU, JOHOR JOHOR",
    area: "JOHOR BAHRU",
    state: "JOHOR",
    clinicPhone: "",
    mobilePhone: "019-727646",
    email: ""
  },
  {
    name: "TAN ANIMAL CLINIC & SURGERY",
    address: "3, JALAN LORONG HAJI HASSAN NINDUNG, PUSAT PERNIAGAAN MAS JAYA, JALAN SALLEH, 84000 MUAR, JOHOR JOHOR",
    area: "84000 MUAR",
    state: "JOHOR",
    clinicPhone: "0129051274",
    mobilePhone: "0129051274",
    email: "tanveterinaryclinic@gmail.com"
  },
  {
    name: "THATS ANIMAL CENTRE",
    address: "57,JALAN MUTIARA EMAS 10/19,TAMAN MOUNT AUSTIN,81100,JOHOR BAHRU 81100 JOHOR BHARU JOHOR",
    area: "81100",
    state: "JOHOR",
    clinicPhone: "73617995.0",
    mobilePhone: "0163386824",
    email: "Thatsanimal@gmail.com"
  },
  {
    name: "UNIVERSITI TEKNOLOGI MALAYSIA",
    address: "UTM, SKUDAI JOHOR BAHRU JOHOR",
    area: "UTM",
    state: "JOHOR",
    clinicPhone: "0.0",
    mobilePhone: "0193188088",
    email: "fuziaton@utm.my"
  },
  {
    name: "UNIVERSITY VETERINARY HOSPITAL",
    address: "NO. 28 JLN KEBUDAYAAN 18, TAMAN UNIVERSITI, 81300 SKUDAI JOHOR",
    area: "TAMAN UNIVERSITI",
    state: "JOHOR",
    clinicPhone: "75208986.0",
    mobilePhone: "0123009986",
    email: "dr_rajeswary@hotmail.com"
  },
  {
    name: "VET PARTNERS (ISKANDAR PUTERI)",
    address: "16-18, JALAN JATI 1, TAMAN NUSA BESTARI JAYA, 79150 ISKANDAR PUTERI, JOHOR JOHOR",
    area: "79150 ISKANDAR PUTERI",
    state: "JOHOR",
    clinicPhone: "",
    mobilePhone: "",
    email: ""
  },
];

(function initKlinikTool_JOHOR() {
  const root = document.getElementById("klinik-haiwan-kl-tool");
  if (!root) return;
  const searchInput = root.querySelector("#ilmu-kl-search");
  const typeSelect  = root.querySelector("#ilmu-kl-type");  // optional, not used here
  const areaSelect  = root.querySelector("#ilmu-kl-area");
  const nearMeBtn   = root.querySelector("#ilmu-kl-nearme");
  const resetBtn    = root.querySelector("#ilmu-kl-reset");
  const resultsWrap = root.querySelector("#ilmu-kl-results");
  const countLabel  = root.querySelector("#ilmu-kl-count");

  function norm(str) {
    return (str || "").toString().toLowerCase();
  }

  function buildMapsUrl(c) {
    const q = encodeURIComponent((c.name || "") + ", " + (c.address || ""));
    return "https://www.google.com/maps/search/?api=1&query=" + q;
  }

  function render(list) {
    resultsWrap.innerHTML = "";
    if (!list.length) {
      resultsWrap.innerHTML = '<p style="font-size:0.9rem;color:#555;">Tiada klinik dijumpai. Cuba ubah kata kunci atau penapis.</p>';
      countLabel.textContent = "0 klinik haiwan ditemui.";
      return;
    }
    const frag = document.createDocumentFragment();
    list.forEach(function(c) {
      const card = document.createElement("article");
      card.className = "ilmu-kl-card";
      card.setAttribute("itemscope", "");
      card.setAttribute("itemtype", "https://schema.org/VeterinaryCare");

      const header = document.createElement("header");
      const nameEl = document.createElement("div");
      nameEl.className = "ilmu-kl-name";
      nameEl.textContent = c.name || "(Tanpa nama klinik)";
      nameEl.setAttribute("itemprop", "name");

      const tagEl = document.createElement("span");
      tagEl.className = "ilmu-kl-tag";
      tagEl.textContent = "JOHOR";

      header.appendChild(nameEl);
      header.appendChild(tagEl);

      const areaEl = document.createElement("div");
      areaEl.className = "ilmu-kl-area";
      areaEl.textContent = "Kawasan: " + (c.area || c.state || "");

      const addrEl = document.createElement("div");
      addrEl.className = "ilmu-kl-address";
      addrEl.innerHTML = "<strong>Alamat:</strong> <span itemprop=\"address\">" + (c.address || "") + "</span>";

      const phoneEl = document.createElement("div");
      phoneEl.className = "ilmu-kl-phone";
      if (c.clinicPhone || c.mobilePhone) {
        const phones = [];
        if (c.clinicPhone) phones.push(c.clinicPhone);
        if (c.mobilePhone) phones.push(c.mobilePhone);
        phoneEl.innerHTML = "<strong>Telefon:</strong> " + phones.map(function(p){ return '<span itemprop=\"telephone\">' + p + "</span>"; }).join(" / ");
      }

      const actionsRow = document.createElement("div");
      actionsRow.className = "ilmu-kl-actions-row";

      const mapsLink = document.createElement("a");
      mapsLink.href = buildMapsUrl(c);
      mapsLink.target = "_blank";
      mapsLink.rel = "noopener nofollow";
      mapsLink.textContent = "Buka di Google Maps";

      const callLink = document.createElement("a");
      const phoneRaw = (c.clinicPhone || c.mobilePhone || "");
      if (phoneRaw) {
        callLink.href = "tel:" + phoneRaw.replace(/[^0-9+]/g, "");
        callLink.textContent = "Call Klinik";
      } else {
        callLink.href = buildMapsUrl(c);
        callLink.textContent = "Info Klinik";
      }

      actionsRow.appendChild(mapsLink);
      actionsRow.appendChild(callLink);

      card.appendChild(header);
      card.appendChild(areaEl);
      card.appendChild(addrEl);
      if (c.clinicPhone || c.mobilePhone) card.appendChild(phoneEl);
      card.appendChild(actionsRow);
      frag.appendChild(card);
    });
    resultsWrap.appendChild(frag);
    countLabel.textContent = list.length + " klinik haiwan & klinik veterinar dijumpai di JOHOR.";
  }

  function applyFilters() {
    const q = norm(searchInput ? searchInput.value : "");
    const areaVal = areaSelect ? areaSelect.value : "";

    const base = ILMU_KLINIK_JOHOR.slice();
    const filtered = base.filter(function(c) {
      if (areaVal) {
        if (!c.area || c.area.indexOf(areaVal) === -1) return false;
      }
      if (!q) return true;
      const haystack = norm((c.name || "") + " " + (c.address || "") + " " + (c.area || "") + " " + (c.state || ""));
      return haystack.indexOf(q) !== -1;
    }).sort(function(a,b){ return (a.name || "").localeCompare(b.name || ""); });

    render(filtered);
  }

  function setupListeners() {
    if (searchInput) searchInput.addEventListener('input', applyFilters);
    if (areaSelect) areaSelect.addEventListener('change', applyFilters);
    if (resetBtn) {
      resetBtn.addEventListener('click', function(){
        if (searchInput) searchInput.value = "";
        if (areaSelect) areaSelect.value = "";
        applyFilters();
      });
    }
    if (nearMeBtn) {
      nearMeBtn.addEventListener('click', function(){
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(function(pos){
            const lat = pos.coords.latitude;
            const lng = pos.coords.longitude;
            const base = "https://www.google.com/maps/search/";
            const q = encodeURIComponent("klinik haiwan veterinar near me");
            const url = base + q + "/@" + lat + "," + lng + ",14z";
            window.open(url, "_blank", "noopener");
          }, function(){
            window.open("https://www.google.com/maps/search/" + encodeURIComponent("klinik haiwan JOHOR near me"), "_blank", "noopener");
          });
        } else {
          window.open("https://www.google.com/maps/search/" + encodeURIComponent("klinik haiwan JOHOR near me"), "_blank", "noopener");
        }
      });
    }
  }

  setupListeners();
  applyFilters();
})();
